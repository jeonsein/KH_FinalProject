<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 따옴표가 필요하면 #{}, 필요하지 않으면 ${} -->
<mapper namespace="org.zerock.myapp.mapper.ProductMapper">
    <select id="SelectOrder" resultType="org.zerock.myapp.domain.ProductVO">
        <!-- SELECT pno, pname, content, image, price, discount, 
        brandname, insert_ts, readcount, (price - (price * (discount / 100))) - mod(price - 
        (price * (discount /100)), 10) as disprice 
        FROM product_list
        ORDER BY ${order} ${order1}
        OFFSET ( #{currPage} -1) * #{amount} ROWS FETCH NEXT #{amount} ROWS ONLY  -->
        
        SELECT pno, pname, content, image, price, discount, 
        brandname, insert_ts, readcount, (price - (price * (discount / 100))) - mod(price - 
        (price * (discount /100)), 10) as disprice,
         ( SELECT count(pno)
	          FROM product_list 
	          ${where} ${brand} ) as totalCount 
        FROM product_list 
        ${where} ${brand}
        ${orderby} ${order} ${order1}
        OFFSET ( #{currPage} -1) * #{amount} ROWS FETCH NEXT #{amount} ROWS ONLY
        
    </select>

    <select id="SelectDetail" resultType="org.zerock.myapp.domain.ProductDTO">
        SELECT pno, pname, content, image, price, discount, 
        brandname, insert_ts, readcount, (price - (price * (discount / 100))) - mod(price - 
        (price * (discount /100)), 10) as disprice, subimage1, subimage2, subimage3, subimage4, ptitle
        FROM product_list
        WHERE pno = #{pno}
    </select>
    
    <select id="SelectApiRecipes" resultType="org.zerock.myapp.domain.ApiRecipesRowVO">
    	SELECT *
    	FROM product_recipes 
    	WHERE rcp_parts_dtls like '%'||#{title}||'%'
    	ORDER BY rcp_seq asc
    </select>
    
    
    <select id="SelectSearchBrand" resultType="org.zerock.myapp.domain.ProductVO">
    	SELECT brandname
        FROM product_list
        GROUP BY brandname
        ORDER BY brandname
    </select>   

    <select id="SelectSearchBrandGet" resultType="org.zerock.myapp.domain.ProductVO">
        SELECT pno, pname, content, image, price, discount, 
        brandname, insert_ts, readcount, (price - (price * (discount / 100))) - mod(price - 
        (price * (discount /100)), 10) as disprice,
	        ( SELECT count(pno)
	          FROM product_list 
	          WHERE brandname in (${brand})) as totalCount 
        FROM product_list
        WHERE brandname in (${brand}) 	
	   OFFSET ( #{currPage} -1) * #{amount} ROWS FETCH NEXT #{amount} ROWS ONLY       	
    </select>
    
</mapper>